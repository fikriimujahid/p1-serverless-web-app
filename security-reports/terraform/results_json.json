{"check_type": "terraform", "results": {"failed_checks": [{"check_id": "CKV_AWS_28", "bc_check_id": "BC_AWS_GENERAL_6", "check_name": "Ensure DynamoDB point in time recovery (backup) is enabled", "check_result": {"result": "FAILED", "evaluated_keys": ["point_in_time_recovery/[0]/enabled"]}, "code_block": [[4, "resource \"aws_dynamodb_table\" \"main\" {\n"], [5, "  for_each = var.tables\n"], [6, "\n"], [7, "  name           = \"${var.project}-${var.environment}-${each.key}\"\n"], [8, "  billing_mode   = each.value.billing_mode # PROVISIONED or PAY_PER_REQUEST\n"], [9, "  hash_key       = each.value.hash_key\n"], [10, "  range_key      = each.value.range_key\n"], [11, "  table_class    = each.value.table_class # STANDARD or STANDARD_INFREQUENT_ACCESS (cost optimization)\n"], [12, "\n"], [13, "  # Attribute definitions\n"], [14, "  dynamic \"attribute\" {\n"], [15, "    for_each = each.value.attributes\n"], [16, "    content {\n"], [17, "      name = attribute.value.name\n"], [18, "      type = attribute.value.type\n"], [19, "    }\n"], [20, "  }\n"], [21, "\n"], [22, "  # Server-side encryption (security best practice - uses AWS owned key)\n"], [23, "  server_side_encryption {\n"], [24, "    enabled = true\n"], [25, "    # kms_key_id omitted = uses AWS owned key (default)\n"], [26, "  }\n"], [27, "\n"], [28, "  # Time to Live (TTL) - cost optimization\n"], [29, "  dynamic \"ttl\" {\n"], [30, "    for_each = each.value.ttl_attribute != null ? [1] : []\n"], [31, "    content {\n"], [32, "      enabled        = true\n"], [33, "      attribute_name = each.value.ttl_attribute\n"], [34, "    }\n"], [35, "  }\n"], [36, "\n"], [37, "  # Deletion protection (safety)\n"], [38, "  deletion_protection_enabled = each.value.deletion_protection_enabled\n"], [39, "\n"], [40, "  # On-demand throughput (for PAY_PER_REQUEST)\n"], [41, "  dynamic \"on_demand_throughput\" {\n"], [42, "    for_each = each.value.on_demand_throughput != null ? [each.value.on_demand_throughput] : []\n"], [43, "    content {\n"], [44, "      max_read_request_units  = on_demand_throughput.value.max_read_request_units\n"], [45, "      max_write_request_units = on_demand_throughput.value.max_write_request_units\n"], [46, "    }\n"], [47, "  }\n"], [48, "\n"], [49, "  # Tags\n"], [50, "  tags = merge(var.tags, {\n"], [51, "    Name        = \"${var.project}-${var.environment}-${each.key}\"\n"], [52, "    Table       = each.key\n"], [53, "  })\n"], [54, "}\n"]], "file_path": "\\modules\\database\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\database\\main.tf", "repo_file_path": "/infra/terraform/modules/database/main.tf", "file_line_range": [4, 54], "resource": "module.database.aws_dynamodb_table.main[\"notes\"]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.DynamodbRecovery", "fixed_definition": null, "entity_tags": {"environment": ["prod"], "managed_by": ["terraform"], "project": ["p1-serverless-web-app"], "Name": ["p1-serverless-web-app-prod-notes"], "Table": ["notes"]}, "caller_file_path": "\\environments\\prod\\main.tf", "caller_file_line_range": [68, 75], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/general-6", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\database\\main.tf"}, {"check_id": "CKV_AWS_119", "bc_check_id": "BC_AWS_GENERAL_52", "check_name": "Ensure DynamoDB Tables are encrypted using a KMS Customer Managed CMK", "check_result": {"result": "FAILED", "evaluated_keys": ["server_side_encryption/[0]/enabled", "server_side_encryption/[0]/kms_key_arn"]}, "code_block": [[4, "resource \"aws_dynamodb_table\" \"main\" {\n"], [5, "  for_each = var.tables\n"], [6, "\n"], [7, "  name           = \"${var.project}-${var.environment}-${each.key}\"\n"], [8, "  billing_mode   = each.value.billing_mode # PROVISIONED or PAY_PER_REQUEST\n"], [9, "  hash_key       = each.value.hash_key\n"], [10, "  range_key      = each.value.range_key\n"], [11, "  table_class    = each.value.table_class # STANDARD or STANDARD_INFREQUENT_ACCESS (cost optimization)\n"], [12, "\n"], [13, "  # Attribute definitions\n"], [14, "  dynamic \"attribute\" {\n"], [15, "    for_each = each.value.attributes\n"], [16, "    content {\n"], [17, "      name = attribute.value.name\n"], [18, "      type = attribute.value.type\n"], [19, "    }\n"], [20, "  }\n"], [21, "\n"], [22, "  # Server-side encryption (security best practice - uses AWS owned key)\n"], [23, "  server_side_encryption {\n"], [24, "    enabled = true\n"], [25, "    # kms_key_id omitted = uses AWS owned key (default)\n"], [26, "  }\n"], [27, "\n"], [28, "  # Time to Live (TTL) - cost optimization\n"], [29, "  dynamic \"ttl\" {\n"], [30, "    for_each = each.value.ttl_attribute != null ? [1] : []\n"], [31, "    content {\n"], [32, "      enabled        = true\n"], [33, "      attribute_name = each.value.ttl_attribute\n"], [34, "    }\n"], [35, "  }\n"], [36, "\n"], [37, "  # Deletion protection (safety)\n"], [38, "  deletion_protection_enabled = each.value.deletion_protection_enabled\n"], [39, "\n"], [40, "  # On-demand throughput (for PAY_PER_REQUEST)\n"], [41, "  dynamic \"on_demand_throughput\" {\n"], [42, "    for_each = each.value.on_demand_throughput != null ? [each.value.on_demand_throughput] : []\n"], [43, "    content {\n"], [44, "      max_read_request_units  = on_demand_throughput.value.max_read_request_units\n"], [45, "      max_write_request_units = on_demand_throughput.value.max_write_request_units\n"], [46, "    }\n"], [47, "  }\n"], [48, "\n"], [49, "  # Tags\n"], [50, "  tags = merge(var.tags, {\n"], [51, "    Name        = \"${var.project}-${var.environment}-${each.key}\"\n"], [52, "    Table       = each.key\n"], [53, "  })\n"], [54, "}\n"]], "file_path": "\\modules\\database\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\database\\main.tf", "repo_file_path": "/infra/terraform/modules/database/main.tf", "file_line_range": [4, 54], "resource": "module.database.aws_dynamodb_table.main[\"notes\"]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.DynamoDBTablesEncrypted", "fixed_definition": null, "entity_tags": {"environment": ["prod"], "managed_by": ["terraform"], "project": ["p1-serverless-web-app"], "Name": ["p1-serverless-web-app-prod-notes"], "Table": ["notes"]}, "caller_file_path": "\\environments\\prod\\main.tf", "caller_file_line_range": [68, 75], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/bc-aws-52", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\database\\main.tf"}, {"check_id": "CKV_AWS_300", "bc_check_id": "BC_AWS_GENERAL_214", "check_name": "Ensure S3 lifecycle configuration sets period for aborting failed uploads", "check_result": {"result": "FAILED", "evaluated_keys": ["rule"]}, "code_block": [[73, "resource \"aws_s3_bucket_lifecycle_configuration\" \"website\" {\n"], [74, "  bucket = aws_s3_bucket.website.id\n"], [75, "\n"], [76, "  rule {\n"], [77, "    id     = \"cleanup-incomplete-multipart-uploads\"\n"], [78, "    status = \"Enabled\"\n"], [79, "\n"], [80, "    filter {} # Apply to all objects\n"], [81, "\n"], [82, "    abort_incomplete_multipart_upload {\n"], [83, "      days_after_initiation = 7\n"], [84, "    }\n"], [85, "  }\n"], [86, "\n"], [87, "  # Transition old versions to cheaper storage classes\n"], [88, "  dynamic \"rule\" {\n"], [89, "    for_each = var.enable_versioning ? [1] : []\n"], [90, "    content {\n"], [91, "      id     = \"transition-old-versions\"\n"], [92, "      status = \"Enabled\"\n"], [93, "\n"], [94, "      filter {} # Apply to all objects\n"], [95, "\n"], [96, "      noncurrent_version_transition {\n"], [97, "        noncurrent_days = 30\n"], [98, "        storage_class   = \"STANDARD_IA\"\n"], [99, "      }\n"], [100, "\n"], [101, "      noncurrent_version_transition {\n"], [102, "        noncurrent_days = 90\n"], [103, "        storage_class   = \"GLACIER\"\n"], [104, "      }\n"], [105, "\n"], [106, "      noncurrent_version_expiration {\n"], [107, "        noncurrent_days = 180\n"], [108, "      }\n"], [109, "    }\n"], [110, "  }\n"], [111, "\n"], [112, "  # Delete old delete markers\n"], [113, "  dynamic \"rule\" {\n"], [114, "    for_each = var.enable_versioning ? [1] : []\n"], [115, "    content {\n"], [116, "      id     = \"delete-old-delete-markers\"\n"], [117, "      status = \"Enabled\"\n"], [118, "\n"], [119, "      filter {} # Apply to all objects\n"], [120, "\n"], [121, "      expiration {\n"], [122, "        expired_object_delete_marker = true\n"], [123, "      }\n"], [124, "    }\n"], [125, "  }\n"], [126, "}\n"]], "file_path": "\\modules\\hosting\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf", "repo_file_path": "/infra/terraform/modules/hosting/main.tf", "file_line_range": [73, 126], "resource": "module.hosting.aws_s3_bucket_lifecycle_configuration.website", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.S3AbortIncompleteUploads", "fixed_definition": null, "entity_tags": null, "caller_file_path": "\\environments\\prod\\main.tf", "caller_file_line_range": [92, 126], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/bc-aws-300", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf"}, {"check_id": "CKV_AWS_192", "bc_check_id": "BC_AWS_NETWORKING_61", "check_name": "Ensure WAF prevents message lookup in Log4j2. See CVE-2021-44228 aka log4jshell", "check_result": {"result": "FAILED", "evaluated_keys": ["rule/[1]/statement/[0]/managed_rule_group_statement"]}, "code_block": [[132, "resource \"aws_wafv2_web_acl\" \"cloudfront\" {\n"], [133, "  count    = var.enable_waf ? 1 : 0\n"], [134, "  provider = aws.us_east_1\n"], [135, "  \n"], [136, "  name        = \"${var.project}-${var.environment}-cloudfront-waf\"\n"], [137, "  description = \"WAF for CloudFront distribution - ${var.environment} environment\"\n"], [138, "  scope       = \"CLOUDFRONT\"\n"], [139, "\n"], [140, "  default_action {\n"], [141, "    allow {}\n"], [142, "  }\n"], [143, "\n"], [144, "  # AWS Managed Rules - Core Rule Set\n"], [145, "  rule {\n"], [146, "    name     = \"AWSManagedRulesCommonRuleSet\"\n"], [147, "    priority = 1\n"], [148, "\n"], [149, "    override_action {\n"], [150, "      none {}\n"], [151, "    }\n"], [152, "\n"], [153, "    statement {\n"], [154, "      managed_rule_group_statement {\n"], [155, "        name        = \"AWSManagedRulesCommonRuleSet\"\n"], [156, "        vendor_name = \"AWS\"\n"], [157, "      }\n"], [158, "    }\n"], [159, "\n"], [160, "    visibility_config {\n"], [161, "      cloudwatch_metrics_enabled = true\n"], [162, "      metric_name                = \"CommonRuleSetMetric\"\n"], [163, "      sampled_requests_enabled   = true\n"], [164, "    }\n"], [165, "  }\n"], [166, "\n"], [167, "  # Rate-based rule\n"], [168, "  rule {\n"], [169, "    name     = \"RateLimitRule\"\n"], [170, "    priority = 2\n"], [171, "\n"], [172, "    action {\n"], [173, "      block {}\n"], [174, "    }\n"], [175, "\n"], [176, "    statement {\n"], [177, "      rate_based_statement {\n"], [178, "        limit              = var.waf_rate_limit\n"], [179, "        aggregate_key_type = \"IP\"\n"], [180, "      }\n"], [181, "    }\n"], [182, "\n"], [183, "    visibility_config {\n"], [184, "      cloudwatch_metrics_enabled = true\n"], [185, "      metric_name                = \"RateLimitRuleMetric\"\n"], [186, "      sampled_requests_enabled   = true\n"], [187, "    }\n"], [188, "  }\n"], [189, "\n"], [190, "  visibility_config {\n"], [191, "    cloudwatch_metrics_enabled = true\n"], [192, "    metric_name                = \"CloudFrontWAFMetric\"\n"], [193, "    sampled_requests_enabled   = true\n"], [194, "  }\n"], [195, "\n"], [196, "  tags = merge(var.tags, {\n"], [197, "    Name = \"${var.project}-${var.environment}-cloudfront-waf\"\n"], [198, "  })\n"], [199, "}\n"]], "file_path": "\\modules\\hosting\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf", "repo_file_path": "/infra/terraform/modules/hosting/main.tf", "file_line_range": [132, 199], "resource": "module.hosting.aws_wafv2_web_acl.cloudfront[0]", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.WAFACLCVE202144228", "fixed_definition": null, "entity_tags": {"environment": "prod", "managed_by": "terraform", "project": "p1-serverless-web-app", "Name": "p1-serverless-web-app-prod-cloudfront-waf"}, "caller_file_path": "\\environments\\prod\\main.tf", "caller_file_line_range": [92, 126], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/ensure-waf-prevents-message-lookup-in-log4j2", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf"}, {"check_id": "CKV_AWS_272", "bc_check_id": "BC_AWS_General_201", "check_name": "Ensure AWS Lambda function is configured to validate code-signing", "check_result": {"result": "FAILED", "evaluated_keys": ["code_signing_config_arn"]}, "code_block": [[211, "resource \"aws_lambda_function\" \"cloudfront_rewrite\" {\n"], [212, "  provider      = aws.us_east_1\n"], [213, "  filename      = data.archive_file.lambda_zip.output_path\n"], [214, "  function_name = \"${var.bucket_name}-cf-rewrite\"\n"], [215, "  role          = aws_iam_role.lambda_edge_role.arn\n"], [216, "  handler       = \"index.handler\"\n"], [217, "  runtime       = \"python3.12\"\n"], [218, "  publish       = true\n"], [219, "\n"], [220, "  source_code_hash = data.archive_file.lambda_zip.output_base64sha256\n"], [221, "}\n"]], "file_path": "\\modules\\hosting\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf", "repo_file_path": "/infra/terraform/modules/hosting/main.tf", "file_line_range": [211, 221], "resource": "module.hosting.aws_lambda_function.cloudfront_rewrite", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.LambdaCodeSigningConfigured", "fixed_definition": null, "entity_tags": null, "caller_file_path": "\\environments\\prod\\main.tf", "caller_file_line_range": [92, 126], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/bc-aws-272", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf"}, {"check_id": "CKV_AWS_116", "bc_check_id": "BC_AWS_GENERAL_64", "check_name": "Ensure that AWS Lambda function is configured for a Dead Letter Queue(DLQ)", "check_result": {"result": "FAILED", "evaluated_keys": ["dead_letter_config/[0]/target_arn"]}, "code_block": [[211, "resource \"aws_lambda_function\" \"cloudfront_rewrite\" {\n"], [212, "  provider      = aws.us_east_1\n"], [213, "  filename      = data.archive_file.lambda_zip.output_path\n"], [214, "  function_name = \"${var.bucket_name}-cf-rewrite\"\n"], [215, "  role          = aws_iam_role.lambda_edge_role.arn\n"], [216, "  handler       = \"index.handler\"\n"], [217, "  runtime       = \"python3.12\"\n"], [218, "  publish       = true\n"], [219, "\n"], [220, "  source_code_hash = data.archive_file.lambda_zip.output_base64sha256\n"], [221, "}\n"]], "file_path": "\\modules\\hosting\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf", "repo_file_path": "/infra/terraform/modules/hosting/main.tf", "file_line_range": [211, 221], "resource": "module.hosting.aws_lambda_function.cloudfront_rewrite", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.LambdaDLQConfigured", "fixed_definition": null, "entity_tags": null, "caller_file_path": "\\environments\\prod\\main.tf", "caller_file_line_range": [92, 126], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-a-dead-letter-queue-dlq", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf"}, {"check_id": "CKV_AWS_115", "bc_check_id": "BC_AWS_GENERAL_63", "check_name": "Ensure that AWS Lambda function is configured for function-level concurrent execution limit", "check_result": {"result": "FAILED", "evaluated_keys": ["reserved_concurrent_executions/[0]"]}, "code_block": [[211, "resource \"aws_lambda_function\" \"cloudfront_rewrite\" {\n"], [212, "  provider      = aws.us_east_1\n"], [213, "  filename      = data.archive_file.lambda_zip.output_path\n"], [214, "  function_name = \"${var.bucket_name}-cf-rewrite\"\n"], [215, "  role          = aws_iam_role.lambda_edge_role.arn\n"], [216, "  handler       = \"index.handler\"\n"], [217, "  runtime       = \"python3.12\"\n"], [218, "  publish       = true\n"], [219, "\n"], [220, "  source_code_hash = data.archive_file.lambda_zip.output_base64sha256\n"], [221, "}\n"]], "file_path": "\\modules\\hosting\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf", "repo_file_path": "/infra/terraform/modules/hosting/main.tf", "file_line_range": [211, 221], "resource": "module.hosting.aws_lambda_function.cloudfront_rewrite", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.LambdaFunctionLevelConcurrentExecutionLimit", "fixed_definition": null, "entity_tags": null, "caller_file_path": "\\environments\\prod\\main.tf", "caller_file_line_range": [92, 126], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-for-function-level-concurrent-execution-limit", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf"}, {"check_id": "CKV_AWS_117", "bc_check_id": "BC_AWS_GENERAL_65", "check_name": "Ensure that AWS Lambda function is configured inside a VPC", "check_result": {"result": "FAILED", "evaluated_keys": ["vpc_config"]}, "code_block": [[211, "resource \"aws_lambda_function\" \"cloudfront_rewrite\" {\n"], [212, "  provider      = aws.us_east_1\n"], [213, "  filename      = data.archive_file.lambda_zip.output_path\n"], [214, "  function_name = \"${var.bucket_name}-cf-rewrite\"\n"], [215, "  role          = aws_iam_role.lambda_edge_role.arn\n"], [216, "  handler       = \"index.handler\"\n"], [217, "  runtime       = \"python3.12\"\n"], [218, "  publish       = true\n"], [219, "\n"], [220, "  source_code_hash = data.archive_file.lambda_zip.output_base64sha256\n"], [221, "}\n"]], "file_path": "\\modules\\hosting\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf", "repo_file_path": "/infra/terraform/modules/hosting/main.tf", "file_line_range": [211, 221], "resource": "module.hosting.aws_lambda_function.cloudfront_rewrite", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.LambdaInVPC", "fixed_definition": null, "entity_tags": null, "caller_file_path": "\\environments\\prod\\main.tf", "caller_file_line_range": [92, 126], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-aws-lambda-function-is-configured-inside-a-vpc-1", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf"}, {"check_id": "CKV_AWS_50", "bc_check_id": "BC_AWS_SERVERLESS_4", "check_name": "X-Ray tracing is enabled for Lambda", "check_result": {"result": "FAILED", "evaluated_keys": ["tracing_config/[0]/mode"]}, "code_block": [[211, "resource \"aws_lambda_function\" \"cloudfront_rewrite\" {\n"], [212, "  provider      = aws.us_east_1\n"], [213, "  filename      = data.archive_file.lambda_zip.output_path\n"], [214, "  function_name = \"${var.bucket_name}-cf-rewrite\"\n"], [215, "  role          = aws_iam_role.lambda_edge_role.arn\n"], [216, "  handler       = \"index.handler\"\n"], [217, "  runtime       = \"python3.12\"\n"], [218, "  publish       = true\n"], [219, "\n"], [220, "  source_code_hash = data.archive_file.lambda_zip.output_base64sha256\n"], [221, "}\n"]], "file_path": "\\modules\\hosting\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf", "repo_file_path": "/infra/terraform/modules/hosting/main.tf", "file_line_range": [211, 221], "resource": "module.hosting.aws_lambda_function.cloudfront_rewrite", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.LambdaXrayEnabled", "fixed_definition": null, "entity_tags": null, "caller_file_path": "\\environments\\prod\\main.tf", "caller_file_line_range": [92, 126], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-serverless-policies/bc-aws-serverless-4", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf"}, {"check_id": "CKV_AWS_310", "bc_check_id": "BC_AWS_GENERAL_222", "check_name": "Ensure CloudFront distributions should have origin failover configured", "check_result": {"result": "FAILED", "evaluated_keys": []}, "code_block": [[272, "resource \"aws_cloudfront_distribution\" \"website\" {\n"], [273, "  enabled             = true\n"], [274, "  is_ipv6_enabled     = true\n"], [275, "  comment             = \"CloudFront distribution for ${var.bucket_name}\"\n"], [276, "  default_root_object = var.default_root_object\n"], [277, "  price_class         = var.price_class\n"], [278, "\n"], [279, "  aliases = var.domain_aliases\n"], [280, "\n"], [281, "  origin {\n"], [282, "    domain_name              = aws_s3_bucket.website.bucket_regional_domain_name\n"], [283, "    origin_id                = \"S3-${aws_s3_bucket.website.id}\"\n"], [284, "    origin_access_control_id = aws_cloudfront_origin_access_control.website.id\n"], [285, "  }\n"], [286, "\n"], [287, "  default_cache_behavior {\n"], [288, "    allowed_methods        = [\"GET\", \"HEAD\", \"OPTIONS\"]\n"], [289, "    cached_methods         = [\"GET\", \"HEAD\"]\n"], [290, "    target_origin_id       = \"S3-${aws_s3_bucket.website.id}\"\n"], [291, "    compress               = true\n"], [292, "    viewer_protocol_policy = \"redirect-to-https\"\n"], [293, "\n"], [294, "    # Use managed cache policy for best practices\n"], [295, "    cache_policy_id = \"4135ea2d-6df8-44a3-9df3-4b5a84be39ad\" # CachingOptimized\n"], [296, "\n"], [297, "    # Lambda@Edge function to rewrite directory requests\n"], [298, "    lambda_function_association {\n"], [299, "      event_type   = \"origin-request\"\n"], [300, "      lambda_arn   = aws_lambda_function.cloudfront_rewrite.qualified_arn\n"], [301, "      include_body = false\n"], [302, "    }\n"], [303, "\n"], [304, "    # Security headers via response headers policy\n"], [305, "    # response_headers_policy_id = aws_cloudfront_response_headers_policy.security.id\n"], [306, "  }\n"], [307, "\n"], [308, "  # Custom error responses\n"], [309, "  dynamic \"custom_error_response\" {\n"], [310, "    for_each = var.custom_error_responses\n"], [311, "    content {\n"], [312, "      error_code         = custom_error_response.value.error_code\n"], [313, "      response_code      = custom_error_response.value.response_code\n"], [314, "      response_page_path = custom_error_response.value.response_page_path\n"], [315, "    }\n"], [316, "  }\n"], [317, "\n"], [318, "  # Geographic restrictions (required block, but can be set to \"none\")\n"], [319, "  restrictions {\n"], [320, "    geo_restriction {\n"], [321, "      restriction_type = var.geo_restriction_type != null ? var.geo_restriction_type : \"none\"\n"], [322, "      locations        = var.geo_restriction_type != null ? var.geo_restriction_locations : []\n"], [323, "    }\n"], [324, "  }\n"], [325, "\n"], [326, "  # SSL/TLS Certificate: use ACM when custom domains provided; otherwise default CF cert\n"], [327, "  viewer_certificate {\n"], [328, "    acm_certificate_arn            = length(var.domain_aliases) > 0 ? data.aws_acm_certificate.existing[0].arn : null\n"], [329, "    cloudfront_default_certificate = length(var.domain_aliases) == 0 ? true : null\n"], [330, "    ssl_support_method             = length(var.domain_aliases) > 0 ? \"sni-only\" : null\n"], [331, "    minimum_protocol_version       = \"TLSv1.2_2021\"\n"], [332, "  }\n"], [333, "\n"], [334, "  # Logging (optional but recommended)\n"], [335, "  dynamic \"logging_config\" {\n"], [336, "    for_each = var.enable_logging ? [1] : []\n"], [337, "    content {\n"], [338, "      bucket          = var.logging_bucket\n"], [339, "      prefix          = var.logging_prefix\n"], [340, "      include_cookies = false\n"], [341, "    }\n"], [342, "  }\n"], [343, "\n"], [344, "  # WAF Web ACL (optional but recommended for security)\n"], [345, "  web_acl_id = var.enable_waf ? aws_wafv2_web_acl.cloudfront[0].arn : var.web_acl_id\n"], [346, "\n"], [347, "  tags = merge(var.tags, {\n"], [348, "    Name = \"${var.bucket_name}-cloudfront\"\n"], [349, "  })\n"], [350, "}\n"]], "file_path": "\\modules\\hosting\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf", "repo_file_path": "/infra/terraform/modules/hosting/main.tf", "file_line_range": [272, 350], "resource": "module.hosting.aws_cloudfront_distribution.website", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.CloudfrontDistributionOriginFailover", "fixed_definition": null, "entity_tags": {"environment": ["prod"], "managed_by": ["terraform"], "project": ["p1-serverless-web-app"], "Name": ["p1-serverless-web-app-prod-website-cloudfront"]}, "caller_file_path": "\\environments\\prod\\main.tf", "caller_file_line_range": [92, 126], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/bc-aws-310", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf"}, {"check_id": "CKV_AWS_374", "bc_check_id": "BC_AWS_NETWORKING_97", "check_name": "Ensure AWS CloudFront web distribution has geo restriction enabled", "check_result": {"result": "FAILED", "evaluated_keys": ["restrictions/[0]/geo_restriction/[0]/restriction_type"]}, "code_block": [[272, "resource \"aws_cloudfront_distribution\" \"website\" {\n"], [273, "  enabled             = true\n"], [274, "  is_ipv6_enabled     = true\n"], [275, "  comment             = \"CloudFront distribution for ${var.bucket_name}\"\n"], [276, "  default_root_object = var.default_root_object\n"], [277, "  price_class         = var.price_class\n"], [278, "\n"], [279, "  aliases = var.domain_aliases\n"], [280, "\n"], [281, "  origin {\n"], [282, "    domain_name              = aws_s3_bucket.website.bucket_regional_domain_name\n"], [283, "    origin_id                = \"S3-${aws_s3_bucket.website.id}\"\n"], [284, "    origin_access_control_id = aws_cloudfront_origin_access_control.website.id\n"], [285, "  }\n"], [286, "\n"], [287, "  default_cache_behavior {\n"], [288, "    allowed_methods        = [\"GET\", \"HEAD\", \"OPTIONS\"]\n"], [289, "    cached_methods         = [\"GET\", \"HEAD\"]\n"], [290, "    target_origin_id       = \"S3-${aws_s3_bucket.website.id}\"\n"], [291, "    compress               = true\n"], [292, "    viewer_protocol_policy = \"redirect-to-https\"\n"], [293, "\n"], [294, "    # Use managed cache policy for best practices\n"], [295, "    cache_policy_id = \"4135ea2d-6df8-44a3-9df3-4b5a84be39ad\" # CachingOptimized\n"], [296, "\n"], [297, "    # Lambda@Edge function to rewrite directory requests\n"], [298, "    lambda_function_association {\n"], [299, "      event_type   = \"origin-request\"\n"], [300, "      lambda_arn   = aws_lambda_function.cloudfront_rewrite.qualified_arn\n"], [301, "      include_body = false\n"], [302, "    }\n"], [303, "\n"], [304, "    # Security headers via response headers policy\n"], [305, "    # response_headers_policy_id = aws_cloudfront_response_headers_policy.security.id\n"], [306, "  }\n"], [307, "\n"], [308, "  # Custom error responses\n"], [309, "  dynamic \"custom_error_response\" {\n"], [310, "    for_each = var.custom_error_responses\n"], [311, "    content {\n"], [312, "      error_code         = custom_error_response.value.error_code\n"], [313, "      response_code      = custom_error_response.value.response_code\n"], [314, "      response_page_path = custom_error_response.value.response_page_path\n"], [315, "    }\n"], [316, "  }\n"], [317, "\n"], [318, "  # Geographic restrictions (required block, but can be set to \"none\")\n"], [319, "  restrictions {\n"], [320, "    geo_restriction {\n"], [321, "      restriction_type = var.geo_restriction_type != null ? var.geo_restriction_type : \"none\"\n"], [322, "      locations        = var.geo_restriction_type != null ? var.geo_restriction_locations : []\n"], [323, "    }\n"], [324, "  }\n"], [325, "\n"], [326, "  # SSL/TLS Certificate: use ACM when custom domains provided; otherwise default CF cert\n"], [327, "  viewer_certificate {\n"], [328, "    acm_certificate_arn            = length(var.domain_aliases) > 0 ? data.aws_acm_certificate.existing[0].arn : null\n"], [329, "    cloudfront_default_certificate = length(var.domain_aliases) == 0 ? true : null\n"], [330, "    ssl_support_method             = length(var.domain_aliases) > 0 ? \"sni-only\" : null\n"], [331, "    minimum_protocol_version       = \"TLSv1.2_2021\"\n"], [332, "  }\n"], [333, "\n"], [334, "  # Logging (optional but recommended)\n"], [335, "  dynamic \"logging_config\" {\n"], [336, "    for_each = var.enable_logging ? [1] : []\n"], [337, "    content {\n"], [338, "      bucket          = var.logging_bucket\n"], [339, "      prefix          = var.logging_prefix\n"], [340, "      include_cookies = false\n"], [341, "    }\n"], [342, "  }\n"], [343, "\n"], [344, "  # WAF Web ACL (optional but recommended for security)\n"], [345, "  web_acl_id = var.enable_waf ? aws_wafv2_web_acl.cloudfront[0].arn : var.web_acl_id\n"], [346, "\n"], [347, "  tags = merge(var.tags, {\n"], [348, "    Name = \"${var.bucket_name}-cloudfront\"\n"], [349, "  })\n"], [350, "}\n"]], "file_path": "\\modules\\hosting\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf", "repo_file_path": "/infra/terraform/modules/hosting/main.tf", "file_line_range": [272, 350], "resource": "module.hosting.aws_cloudfront_distribution.website", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.CloudFrontGeoRestrictionDisabled", "fixed_definition": null, "entity_tags": {"environment": ["prod"], "managed_by": ["terraform"], "project": ["p1-serverless-web-app"], "Name": ["p1-serverless-web-app-prod-website-cloudfront"]}, "caller_file_path": "\\environments\\prod\\main.tf", "caller_file_line_range": [92, 126], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/bc-aws-374", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf"}, {"check_id": "CKV_AWS_62", "bc_check_id": "BC_AWS_IAM_47", "check_name": "Ensure IAM policies that allow full \"*-*\" administrative privileges are not created", "check_result": {"result": "FAILED", "evaluated_keys": ["policy", "inline_policy"]}, "code_block": [[124, "resource \"aws_iam_policy\" \"terraform_dev_policy\" {\n"], [125, "  name = \"TerraformDevPolicy\"\n"], [126, "\n"], [127, "  policy = jsonencode({\n"], [128, "    Version = \"2012-10-17\"\n"], [129, "    Statement = [\n"], [130, "      {\n"], [131, "        Effect = \"Allow\"\n"], [132, "        Action = \"*\"\n"], [133, "        Resource = \"*\"\n"], [134, "      },\n"], [135, "      {\n"], [136, "        Effect = \"Deny\"\n"], [137, "        Action = \"*\"\n"], [138, "        Resource = \"*\"\n"], [139, "        Condition = {\n"], [140, "          StringEquals = {\n"], [141, "            \"aws:ResourceTag/environment\" = \"prod\"\n"], [142, "          }\n"], [143, "        }\n"], [144, "      },\n"], [145, "      {\n"], [146, "        Effect = \"Deny\"\n"], [147, "        Action = [\n"], [148, "          \"s3:GetObject\",\n"], [149, "          \"s3:PutObject\",\n"], [150, "          \"s3:DeleteObject\"\n"], [151, "        ]\n"], [152, "        Resource = \"${var.terraform_state_bucket_arn}/prod/*\"\n"], [153, "      }\n"], [154, "    ]\n"], [155, "  })\n"], [156, "\n"], [157, "  tags = {\n"], [158, "    project     = var.project\n"], [159, "    environment = \"shared\"\n"], [160, "    managed_by  = \"terraform\"\n"], [161, "  }\n"], [162, "}\n"]], "file_path": "\\modules\\iam-roles\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf", "repo_file_path": "/infra/terraform/modules/iam-roles/main.tf", "file_line_range": [124, 162], "resource": "module.iam_roles.aws_iam_policy.terraform_dev_policy", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.IAMAdminPolicyDocument", "fixed_definition": null, "entity_tags": {"environment": "shared", "managed_by": "terraform", "project": "p1-serverless-web-app"}, "caller_file_path": "\\environments\\bootstrap\\main.tf", "caller_file_line_range": [36, 43], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-iam-policies/bc-aws-iam-45", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf"}, {"check_id": "CKV_AWS_289", "bc_check_id": "BC_AWS_IAM_84", "check_name": "Ensure IAM policies does not allow permissions management / resource exposure without constraints", "check_result": {"result": "FAILED", "evaluated_keys": ["policy/Statement/[0]/Action"]}, "code_block": [[124, "resource \"aws_iam_policy\" \"terraform_dev_policy\" {\n"], [125, "  name = \"TerraformDevPolicy\"\n"], [126, "\n"], [127, "  policy = jsonencode({\n"], [128, "    Version = \"2012-10-17\"\n"], [129, "    Statement = [\n"], [130, "      {\n"], [131, "        Effect = \"Allow\"\n"], [132, "        Action = \"*\"\n"], [133, "        Resource = \"*\"\n"], [134, "      },\n"], [135, "      {\n"], [136, "        Effect = \"Deny\"\n"], [137, "        Action = \"*\"\n"], [138, "        Resource = \"*\"\n"], [139, "        Condition = {\n"], [140, "          StringEquals = {\n"], [141, "            \"aws:ResourceTag/environment\" = \"prod\"\n"], [142, "          }\n"], [143, "        }\n"], [144, "      },\n"], [145, "      {\n"], [146, "        Effect = \"Deny\"\n"], [147, "        Action = [\n"], [148, "          \"s3:GetObject\",\n"], [149, "          \"s3:PutObject\",\n"], [150, "          \"s3:DeleteObject\"\n"], [151, "        ]\n"], [152, "        Resource = \"${var.terraform_state_bucket_arn}/prod/*\"\n"], [153, "      }\n"], [154, "    ]\n"], [155, "  })\n"], [156, "\n"], [157, "  tags = {\n"], [158, "    project     = var.project\n"], [159, "    environment = \"shared\"\n"], [160, "    managed_by  = \"terraform\"\n"], [161, "  }\n"], [162, "}\n"]], "file_path": "\\modules\\iam-roles\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf", "repo_file_path": "/infra/terraform/modules/iam-roles/main.tf", "file_line_range": [124, 162], "resource": "module.iam_roles.aws_iam_policy.terraform_dev_policy", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.IAMPermissionsManagement", "fixed_definition": null, "entity_tags": {"environment": "shared", "managed_by": "terraform", "project": "p1-serverless-web-app"}, "caller_file_path": "\\environments\\bootstrap\\main.tf", "caller_file_line_range": [36, 43], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-iam-policies/bc-aws-289", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf"}, {"check_id": "CKV_AWS_63", "bc_check_id": "BC_AWS_IAM_48", "check_name": "Ensure no IAM policies documents allow \"*\" as a statement's actions", "check_result": {"result": "FAILED", "evaluated_keys": ["policy", "inline_policy"]}, "code_block": [[124, "resource \"aws_iam_policy\" \"terraform_dev_policy\" {\n"], [125, "  name = \"TerraformDevPolicy\"\n"], [126, "\n"], [127, "  policy = jsonencode({\n"], [128, "    Version = \"2012-10-17\"\n"], [129, "    Statement = [\n"], [130, "      {\n"], [131, "        Effect = \"Allow\"\n"], [132, "        Action = \"*\"\n"], [133, "        Resource = \"*\"\n"], [134, "      },\n"], [135, "      {\n"], [136, "        Effect = \"Deny\"\n"], [137, "        Action = \"*\"\n"], [138, "        Resource = \"*\"\n"], [139, "        Condition = {\n"], [140, "          StringEquals = {\n"], [141, "            \"aws:ResourceTag/environment\" = \"prod\"\n"], [142, "          }\n"], [143, "        }\n"], [144, "      },\n"], [145, "      {\n"], [146, "        Effect = \"Deny\"\n"], [147, "        Action = [\n"], [148, "          \"s3:GetObject\",\n"], [149, "          \"s3:PutObject\",\n"], [150, "          \"s3:DeleteObject\"\n"], [151, "        ]\n"], [152, "        Resource = \"${var.terraform_state_bucket_arn}/prod/*\"\n"], [153, "      }\n"], [154, "    ]\n"], [155, "  })\n"], [156, "\n"], [157, "  tags = {\n"], [158, "    project     = var.project\n"], [159, "    environment = \"shared\"\n"], [160, "    managed_by  = \"terraform\"\n"], [161, "  }\n"], [162, "}\n"]], "file_path": "\\modules\\iam-roles\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf", "repo_file_path": "/infra/terraform/modules/iam-roles/main.tf", "file_line_range": [124, 162], "resource": "module.iam_roles.aws_iam_policy.terraform_dev_policy", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.IAMStarActionPolicyDocument", "fixed_definition": null, "entity_tags": {"environment": "shared", "managed_by": "terraform", "project": "p1-serverless-web-app"}, "caller_file_path": "\\environments\\bootstrap\\main.tf", "caller_file_line_range": [36, 43], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-iam-policies/iam-48", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf"}, {"check_id": "CKV_AWS_290", "bc_check_id": "BC_AWS_IAM_85", "check_name": "Ensure IAM policies does not allow write access without constraints", "check_result": {"result": "FAILED", "evaluated_keys": ["policy/Statement/[0]/Action"]}, "code_block": [[124, "resource \"aws_iam_policy\" \"terraform_dev_policy\" {\n"], [125, "  name = \"TerraformDevPolicy\"\n"], [126, "\n"], [127, "  policy = jsonencode({\n"], [128, "    Version = \"2012-10-17\"\n"], [129, "    Statement = [\n"], [130, "      {\n"], [131, "        Effect = \"Allow\"\n"], [132, "        Action = \"*\"\n"], [133, "        Resource = \"*\"\n"], [134, "      },\n"], [135, "      {\n"], [136, "        Effect = \"Deny\"\n"], [137, "        Action = \"*\"\n"], [138, "        Resource = \"*\"\n"], [139, "        Condition = {\n"], [140, "          StringEquals = {\n"], [141, "            \"aws:ResourceTag/environment\" = \"prod\"\n"], [142, "          }\n"], [143, "        }\n"], [144, "      },\n"], [145, "      {\n"], [146, "        Effect = \"Deny\"\n"], [147, "        Action = [\n"], [148, "          \"s3:GetObject\",\n"], [149, "          \"s3:PutObject\",\n"], [150, "          \"s3:DeleteObject\"\n"], [151, "        ]\n"], [152, "        Resource = \"${var.terraform_state_bucket_arn}/prod/*\"\n"], [153, "      }\n"], [154, "    ]\n"], [155, "  })\n"], [156, "\n"], [157, "  tags = {\n"], [158, "    project     = var.project\n"], [159, "    environment = \"shared\"\n"], [160, "    managed_by  = \"terraform\"\n"], [161, "  }\n"], [162, "}\n"]], "file_path": "\\modules\\iam-roles\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf", "repo_file_path": "/infra/terraform/modules/iam-roles/main.tf", "file_line_range": [124, 162], "resource": "module.iam_roles.aws_iam_policy.terraform_dev_policy", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.IAMWriteAccess", "fixed_definition": null, "entity_tags": {"environment": "shared", "managed_by": "terraform", "project": "p1-serverless-web-app"}, "caller_file_path": "\\environments\\bootstrap\\main.tf", "caller_file_line_range": [36, 43], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-iam-policies/bc-aws-290", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf"}, {"check_id": "CKV_AWS_62", "bc_check_id": "BC_AWS_IAM_47", "check_name": "Ensure IAM policies that allow full \"*-*\" administrative privileges are not created", "check_result": {"result": "FAILED", "evaluated_keys": ["policy", "inline_policy"]}, "code_block": [[165, "resource \"aws_iam_policy\" \"terraform_prod_policy\" {\n"], [166, "  name = \"TerraformProdPolicy\"\n"], [167, "\n"], [168, "  policy = jsonencode({\n"], [169, "    Version = \"2012-10-17\"\n"], [170, "    Statement = [\n"], [171, "      {\n"], [172, "        Effect = \"Allow\"\n"], [173, "        Action = \"*\"\n"], [174, "        Resource = \"*\"\n"], [175, "      }\n"], [176, "    ]\n"], [177, "  })\n"], [178, "\n"], [179, "  tags = {\n"], [180, "    project     = var.project\n"], [181, "    environment = \"shared\"\n"], [182, "    managed_by  = \"terraform\"\n"], [183, "  }\n"], [184, "}\n"]], "file_path": "\\modules\\iam-roles\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf", "repo_file_path": "/infra/terraform/modules/iam-roles/main.tf", "file_line_range": [165, 184], "resource": "module.iam_roles.aws_iam_policy.terraform_prod_policy", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.IAMAdminPolicyDocument", "fixed_definition": null, "entity_tags": {"environment": "shared", "managed_by": "terraform", "project": "p1-serverless-web-app"}, "caller_file_path": "\\environments\\bootstrap\\main.tf", "caller_file_line_range": [36, 43], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-iam-policies/bc-aws-iam-45", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf"}, {"check_id": "CKV_AWS_287", "bc_check_id": "BC_AWS_IAM_82", "check_name": "Ensure IAM policies does not allow credentials exposure", "check_result": {"result": "FAILED", "evaluated_keys": ["policy/Statement/[0]/Action"]}, "code_block": [[165, "resource \"aws_iam_policy\" \"terraform_prod_policy\" {\n"], [166, "  name = \"TerraformProdPolicy\"\n"], [167, "\n"], [168, "  policy = jsonencode({\n"], [169, "    Version = \"2012-10-17\"\n"], [170, "    Statement = [\n"], [171, "      {\n"], [172, "        Effect = \"Allow\"\n"], [173, "        Action = \"*\"\n"], [174, "        Resource = \"*\"\n"], [175, "      }\n"], [176, "    ]\n"], [177, "  })\n"], [178, "\n"], [179, "  tags = {\n"], [180, "    project     = var.project\n"], [181, "    environment = \"shared\"\n"], [182, "    managed_by  = \"terraform\"\n"], [183, "  }\n"], [184, "}\n"]], "file_path": "\\modules\\iam-roles\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf", "repo_file_path": "/infra/terraform/modules/iam-roles/main.tf", "file_line_range": [165, 184], "resource": "module.iam_roles.aws_iam_policy.terraform_prod_policy", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.IAMCredentialsExposure", "fixed_definition": null, "entity_tags": {"environment": "shared", "managed_by": "terraform", "project": "p1-serverless-web-app"}, "caller_file_path": "\\environments\\bootstrap\\main.tf", "caller_file_line_range": [36, 43], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-iam-policies/bc-aws-287", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf"}, {"check_id": "CKV_AWS_288", "bc_check_id": "BC_AWS_IAM_83", "check_name": "Ensure IAM policies does not allow data exfiltration", "check_result": {"result": "FAILED", "evaluated_keys": ["policy/Statement/[0]/Action"]}, "code_block": [[165, "resource \"aws_iam_policy\" \"terraform_prod_policy\" {\n"], [166, "  name = \"TerraformProdPolicy\"\n"], [167, "\n"], [168, "  policy = jsonencode({\n"], [169, "    Version = \"2012-10-17\"\n"], [170, "    Statement = [\n"], [171, "      {\n"], [172, "        Effect = \"Allow\"\n"], [173, "        Action = \"*\"\n"], [174, "        Resource = \"*\"\n"], [175, "      }\n"], [176, "    ]\n"], [177, "  })\n"], [178, "\n"], [179, "  tags = {\n"], [180, "    project     = var.project\n"], [181, "    environment = \"shared\"\n"], [182, "    managed_by  = \"terraform\"\n"], [183, "  }\n"], [184, "}\n"]], "file_path": "\\modules\\iam-roles\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf", "repo_file_path": "/infra/terraform/modules/iam-roles/main.tf", "file_line_range": [165, 184], "resource": "module.iam_roles.aws_iam_policy.terraform_prod_policy", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.IAMDataExfiltration", "fixed_definition": null, "entity_tags": {"environment": "shared", "managed_by": "terraform", "project": "p1-serverless-web-app"}, "caller_file_path": "\\environments\\bootstrap\\main.tf", "caller_file_line_range": [36, 43], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-iam-policies/bc-aws-288", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf"}, {"check_id": "CKV_AWS_289", "bc_check_id": "BC_AWS_IAM_84", "check_name": "Ensure IAM policies does not allow permissions management / resource exposure without constraints", "check_result": {"result": "FAILED", "evaluated_keys": ["policy/Statement/[0]/Action"]}, "code_block": [[165, "resource \"aws_iam_policy\" \"terraform_prod_policy\" {\n"], [166, "  name = \"TerraformProdPolicy\"\n"], [167, "\n"], [168, "  policy = jsonencode({\n"], [169, "    Version = \"2012-10-17\"\n"], [170, "    Statement = [\n"], [171, "      {\n"], [172, "        Effect = \"Allow\"\n"], [173, "        Action = \"*\"\n"], [174, "        Resource = \"*\"\n"], [175, "      }\n"], [176, "    ]\n"], [177, "  })\n"], [178, "\n"], [179, "  tags = {\n"], [180, "    project     = var.project\n"], [181, "    environment = \"shared\"\n"], [182, "    managed_by  = \"terraform\"\n"], [183, "  }\n"], [184, "}\n"]], "file_path": "\\modules\\iam-roles\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf", "repo_file_path": "/infra/terraform/modules/iam-roles/main.tf", "file_line_range": [165, 184], "resource": "module.iam_roles.aws_iam_policy.terraform_prod_policy", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.IAMPermissionsManagement", "fixed_definition": null, "entity_tags": {"environment": "shared", "managed_by": "terraform", "project": "p1-serverless-web-app"}, "caller_file_path": "\\environments\\bootstrap\\main.tf", "caller_file_line_range": [36, 43], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-iam-policies/bc-aws-289", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf"}, {"check_id": "CKV_AWS_286", "bc_check_id": "BC_AWS_IAM_81", "check_name": "Ensure IAM policies does not allow privilege escalation", "check_result": {"result": "FAILED", "evaluated_keys": ["policy/Statement/[0]/Action"]}, "code_block": [[165, "resource \"aws_iam_policy\" \"terraform_prod_policy\" {\n"], [166, "  name = \"TerraformProdPolicy\"\n"], [167, "\n"], [168, "  policy = jsonencode({\n"], [169, "    Version = \"2012-10-17\"\n"], [170, "    Statement = [\n"], [171, "      {\n"], [172, "        Effect = \"Allow\"\n"], [173, "        Action = \"*\"\n"], [174, "        Resource = \"*\"\n"], [175, "      }\n"], [176, "    ]\n"], [177, "  })\n"], [178, "\n"], [179, "  tags = {\n"], [180, "    project     = var.project\n"], [181, "    environment = \"shared\"\n"], [182, "    managed_by  = \"terraform\"\n"], [183, "  }\n"], [184, "}\n"]], "file_path": "\\modules\\iam-roles\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf", "repo_file_path": "/infra/terraform/modules/iam-roles/main.tf", "file_line_range": [165, 184], "resource": "module.iam_roles.aws_iam_policy.terraform_prod_policy", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.IAMPrivilegeEscalation", "fixed_definition": null, "entity_tags": {"environment": "shared", "managed_by": "terraform", "project": "p1-serverless-web-app"}, "caller_file_path": "\\environments\\bootstrap\\main.tf", "caller_file_line_range": [36, 43], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-iam-policies/bc-aws-286", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf"}, {"check_id": "CKV_AWS_63", "bc_check_id": "BC_AWS_IAM_48", "check_name": "Ensure no IAM policies documents allow \"*\" as a statement's actions", "check_result": {"result": "FAILED", "evaluated_keys": ["policy", "inline_policy"]}, "code_block": [[165, "resource \"aws_iam_policy\" \"terraform_prod_policy\" {\n"], [166, "  name = \"TerraformProdPolicy\"\n"], [167, "\n"], [168, "  policy = jsonencode({\n"], [169, "    Version = \"2012-10-17\"\n"], [170, "    Statement = [\n"], [171, "      {\n"], [172, "        Effect = \"Allow\"\n"], [173, "        Action = \"*\"\n"], [174, "        Resource = \"*\"\n"], [175, "      }\n"], [176, "    ]\n"], [177, "  })\n"], [178, "\n"], [179, "  tags = {\n"], [180, "    project     = var.project\n"], [181, "    environment = \"shared\"\n"], [182, "    managed_by  = \"terraform\"\n"], [183, "  }\n"], [184, "}\n"]], "file_path": "\\modules\\iam-roles\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf", "repo_file_path": "/infra/terraform/modules/iam-roles/main.tf", "file_line_range": [165, 184], "resource": "module.iam_roles.aws_iam_policy.terraform_prod_policy", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.IAMStarActionPolicyDocument", "fixed_definition": null, "entity_tags": {"environment": "shared", "managed_by": "terraform", "project": "p1-serverless-web-app"}, "caller_file_path": "\\environments\\bootstrap\\main.tf", "caller_file_line_range": [36, 43], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-iam-policies/iam-48", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf"}, {"check_id": "CKV_AWS_355", "bc_check_id": "BC_AWS_IAM_88", "check_name": "Ensure no IAM policies documents allow \"*\" as a statement's resource for restrictable actions", "check_result": {"result": "FAILED", "evaluated_keys": ["policy/Statement/[0]/Action"]}, "code_block": [[165, "resource \"aws_iam_policy\" \"terraform_prod_policy\" {\n"], [166, "  name = \"TerraformProdPolicy\"\n"], [167, "\n"], [168, "  policy = jsonencode({\n"], [169, "    Version = \"2012-10-17\"\n"], [170, "    Statement = [\n"], [171, "      {\n"], [172, "        Effect = \"Allow\"\n"], [173, "        Action = \"*\"\n"], [174, "        Resource = \"*\"\n"], [175, "      }\n"], [176, "    ]\n"], [177, "  })\n"], [178, "\n"], [179, "  tags = {\n"], [180, "    project     = var.project\n"], [181, "    environment = \"shared\"\n"], [182, "    managed_by  = \"terraform\"\n"], [183, "  }\n"], [184, "}\n"]], "file_path": "\\modules\\iam-roles\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf", "repo_file_path": "/infra/terraform/modules/iam-roles/main.tf", "file_line_range": [165, 184], "resource": "module.iam_roles.aws_iam_policy.terraform_prod_policy", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.IAMStarResourcePolicyDocument", "fixed_definition": null, "entity_tags": {"environment": "shared", "managed_by": "terraform", "project": "p1-serverless-web-app"}, "caller_file_path": "\\environments\\bootstrap\\main.tf", "caller_file_line_range": [36, 43], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-iam-policies/bc-aws-355", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf"}, {"check_id": "CKV_AWS_290", "bc_check_id": "BC_AWS_IAM_85", "check_name": "Ensure IAM policies does not allow write access without constraints", "check_result": {"result": "FAILED", "evaluated_keys": ["policy/Statement/[0]/Action"]}, "code_block": [[165, "resource \"aws_iam_policy\" \"terraform_prod_policy\" {\n"], [166, "  name = \"TerraformProdPolicy\"\n"], [167, "\n"], [168, "  policy = jsonencode({\n"], [169, "    Version = \"2012-10-17\"\n"], [170, "    Statement = [\n"], [171, "      {\n"], [172, "        Effect = \"Allow\"\n"], [173, "        Action = \"*\"\n"], [174, "        Resource = \"*\"\n"], [175, "      }\n"], [176, "    ]\n"], [177, "  })\n"], [178, "\n"], [179, "  tags = {\n"], [180, "    project     = var.project\n"], [181, "    environment = \"shared\"\n"], [182, "    managed_by  = \"terraform\"\n"], [183, "  }\n"], [184, "}\n"]], "file_path": "\\modules\\iam-roles\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf", "repo_file_path": "/infra/terraform/modules/iam-roles/main.tf", "file_line_range": [165, 184], "resource": "module.iam_roles.aws_iam_policy.terraform_prod_policy", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.IAMWriteAccess", "fixed_definition": null, "entity_tags": {"environment": "shared", "managed_by": "terraform", "project": "p1-serverless-web-app"}, "caller_file_path": "\\environments\\bootstrap\\main.tf", "caller_file_line_range": [36, 43], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-iam-policies/bc-aws-290", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf"}, {"check_id": "CKV_AWS_355", "bc_check_id": "BC_AWS_IAM_88", "check_name": "Ensure no IAM policies documents allow \"*\" as a statement's resource for restrictable actions", "check_result": {"result": "FAILED", "evaluated_keys": ["policy/Statement/[1]/Action"]}, "code_block": [[187, "resource \"aws_iam_policy\" \"cicd_runner_policy\" {\n"], [188, "  name = \"CICDRunnerPolicy\"\n"], [189, "\n"], [190, "  policy = jsonencode({\n"], [191, "    Version = \"2012-10-17\"\n"], [192, "    Statement = [\n"], [193, "      {\n"], [194, "        Effect = \"Allow\"\n"], [195, "        Action = [\n"], [196, "          \"sts:AssumeRole\"\n"], [197, "        ]\n"], [198, "        Resource = [\n"], [199, "          aws_iam_role.terraform_dev.arn,\n"], [200, "          aws_iam_role.terraform_prod.arn\n"], [201, "        ]\n"], [202, "      },\n"], [203, "      {\n"], [204, "        Effect = \"Allow\"\n"], [205, "        Action = [\n"], [206, "          \"logs:CreateLogGroup\",\n"], [207, "          \"logs:CreateLogStream\",\n"], [208, "          \"logs:PutLogEvents\"\n"], [209, "        ]\n"], [210, "        Resource = \"*\"\n"], [211, "      }\n"], [212, "    ]\n"], [213, "  })\n"], [214, "\n"], [215, "  tags = {\n"], [216, "    project     = var.project\n"], [217, "    environment = \"shared\"\n"], [218, "    managed_by  = \"terraform\"\n"], [219, "  }\n"], [220, "}\n"]], "file_path": "\\modules\\iam-roles\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf", "repo_file_path": "/infra/terraform/modules/iam-roles/main.tf", "file_line_range": [187, 220], "resource": "module.iam_roles.aws_iam_policy.cicd_runner_policy", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.IAMStarResourcePolicyDocument", "fixed_definition": null, "entity_tags": {"environment": "shared", "managed_by": "terraform", "project": "p1-serverless-web-app"}, "caller_file_path": "\\environments\\bootstrap\\main.tf", "caller_file_line_range": [36, 43], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-iam-policies/bc-aws-355", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf"}, {"check_id": "CKV_AWS_290", "bc_check_id": "BC_AWS_IAM_85", "check_name": "Ensure IAM policies does not allow write access without constraints", "check_result": {"result": "FAILED", "evaluated_keys": ["policy/Statement/[1]/Action"]}, "code_block": [[187, "resource \"aws_iam_policy\" \"cicd_runner_policy\" {\n"], [188, "  name = \"CICDRunnerPolicy\"\n"], [189, "\n"], [190, "  policy = jsonencode({\n"], [191, "    Version = \"2012-10-17\"\n"], [192, "    Statement = [\n"], [193, "      {\n"], [194, "        Effect = \"Allow\"\n"], [195, "        Action = [\n"], [196, "          \"sts:AssumeRole\"\n"], [197, "        ]\n"], [198, "        Resource = [\n"], [199, "          aws_iam_role.terraform_dev.arn,\n"], [200, "          aws_iam_role.terraform_prod.arn\n"], [201, "        ]\n"], [202, "      },\n"], [203, "      {\n"], [204, "        Effect = \"Allow\"\n"], [205, "        Action = [\n"], [206, "          \"logs:CreateLogGroup\",\n"], [207, "          \"logs:CreateLogStream\",\n"], [208, "          \"logs:PutLogEvents\"\n"], [209, "        ]\n"], [210, "        Resource = \"*\"\n"], [211, "      }\n"], [212, "    ]\n"], [213, "  })\n"], [214, "\n"], [215, "  tags = {\n"], [216, "    project     = var.project\n"], [217, "    environment = \"shared\"\n"], [218, "    managed_by  = \"terraform\"\n"], [219, "  }\n"], [220, "}\n"]], "file_path": "\\modules\\iam-roles\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf", "repo_file_path": "/infra/terraform/modules/iam-roles/main.tf", "file_line_range": [187, 220], "resource": "module.iam_roles.aws_iam_policy.cicd_runner_policy", "evaluations": null, "check_class": "checkov.terraform.checks.resource.aws.IAMWriteAccess", "fixed_definition": null, "entity_tags": {"environment": "shared", "managed_by": "terraform", "project": "p1-serverless-web-app"}, "caller_file_path": "\\environments\\bootstrap\\main.tf", "caller_file_line_range": [36, 43], "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-iam-policies/bc-aws-290", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf"}, {"check_id": "CKV2_AWS_32", "bc_check_id": "BC_AWS_NETWORKING_65", "check_name": "Ensure CloudFront distribution has a response headers policy attached", "check_result": {"result": "FAILED", "entity": {"aws_cloudfront_distribution": {"website": {"__end_line__": 350, "__start_line__": 272, "aliases": ["p1.fikri.dev"], "comment": ["CloudFront distribution for p1-serverless-web-app-prod-website"], "default_cache_behavior": [{"allowed_methods": [[["GET"], ["HEAD"], ["OPTIONS"]]], "cache_policy_id": ["4135ea2d-6df8-44a3-9df3-4b5a84be39ad"], "cached_methods": [[["GET"], ["HEAD"]]], "compress": [true], "lambda_function_association": [{"event_type": ["origin-request"], "include_body": [false], "lambda_arn": ["aws_lambda_function.cloudfront_rewrite.qualified_arn"]}], "target_origin_id": ["S3-${aws_s3_bucket.website.id}"], "viewer_protocol_policy": ["redirect-to-https"]}], "default_root_object": ["index.html"], "dynamic": [{"custom_error_response": [{"error_code": [404], "response_code": [404], "response_page_path": ["/index.html"]}, {"error_code": [403], "response_code": [404], "response_page_path": ["/index.html"]}]}, {"logging_config": [{"bucket": ["var.logging_bucket"], "include_cookies": [false], "prefix": ["var.logging_prefix"]}]}], "enabled": [true], "is_ipv6_enabled": [true], "origin": [{"domain_name": ["aws_s3_bucket.website.bucket_regional_domain_name"], "origin_access_control_id": ["aws_cloudfront_origin_access_control.website.id"], "origin_id": ["S3-${aws_s3_bucket.website.id}"]}], "price_class": ["PriceClass_100"], "restrictions": [{"geo_restriction": [{"locations": [], "restriction_type": ["none"]}]}], "tags": [{"environment": ["prod"], "managed_by": ["terraform"], "project": ["p1-serverless-web-app"], "Name": ["p1-serverless-web-app-prod-website-cloudfront"]}], "viewer_certificate": [{"acm_certificate_arn": ["data.aws_acm_certificate.existing[0].arn"], "cloudfront_default_certificate": ["None"], "minimum_protocol_version": ["TLSv1.2_2021"], "ssl_support_method": ["sni-only"]}], "web_acl_id": ["aws_wafv2_web_acl.cloudfront[0].arn"], "__address__": "module.hosting.aws_cloudfront_distribution.website", "__provider_address__": "aws", "custom_error_response": [{"error_code": [404], "response_code": [404], "response_page_path": ["/index.html"]}, {"error_code": [403], "response_code": [404], "response_page_path": ["/index.html"]}], "logging_config": [{"bucket": ["var.logging_bucket"], "include_cookies": [false], "prefix": ["var.logging_prefix"]}]}}}, "evaluated_keys": ["resource_type"]}, "code_block": [[272, "resource \"aws_cloudfront_distribution\" \"website\" {\n"], [273, "  enabled             = true\n"], [274, "  is_ipv6_enabled     = true\n"], [275, "  comment             = \"CloudFront distribution for ${var.bucket_name}\"\n"], [276, "  default_root_object = var.default_root_object\n"], [277, "  price_class         = var.price_class\n"], [278, "\n"], [279, "  aliases = var.domain_aliases\n"], [280, "\n"], [281, "  origin {\n"], [282, "    domain_name              = aws_s3_bucket.website.bucket_regional_domain_name\n"], [283, "    origin_id                = \"S3-${aws_s3_bucket.website.id}\"\n"], [284, "    origin_access_control_id = aws_cloudfront_origin_access_control.website.id\n"], [285, "  }\n"], [286, "\n"], [287, "  default_cache_behavior {\n"], [288, "    allowed_methods        = [\"GET\", \"HEAD\", \"OPTIONS\"]\n"], [289, "    cached_methods         = [\"GET\", \"HEAD\"]\n"], [290, "    target_origin_id       = \"S3-${aws_s3_bucket.website.id}\"\n"], [291, "    compress               = true\n"], [292, "    viewer_protocol_policy = \"redirect-to-https\"\n"], [293, "\n"], [294, "    # Use managed cache policy for best practices\n"], [295, "    cache_policy_id = \"4135ea2d-6df8-44a3-9df3-4b5a84be39ad\" # CachingOptimized\n"], [296, "\n"], [297, "    # Lambda@Edge function to rewrite directory requests\n"], [298, "    lambda_function_association {\n"], [299, "      event_type   = \"origin-request\"\n"], [300, "      lambda_arn   = aws_lambda_function.cloudfront_rewrite.qualified_arn\n"], [301, "      include_body = false\n"], [302, "    }\n"], [303, "\n"], [304, "    # Security headers via response headers policy\n"], [305, "    # response_headers_policy_id = aws_cloudfront_response_headers_policy.security.id\n"], [306, "  }\n"], [307, "\n"], [308, "  # Custom error responses\n"], [309, "  dynamic \"custom_error_response\" {\n"], [310, "    for_each = var.custom_error_responses\n"], [311, "    content {\n"], [312, "      error_code         = custom_error_response.value.error_code\n"], [313, "      response_code      = custom_error_response.value.response_code\n"], [314, "      response_page_path = custom_error_response.value.response_page_path\n"], [315, "    }\n"], [316, "  }\n"], [317, "\n"], [318, "  # Geographic restrictions (required block, but can be set to \"none\")\n"], [319, "  restrictions {\n"], [320, "    geo_restriction {\n"], [321, "      restriction_type = var.geo_restriction_type != null ? var.geo_restriction_type : \"none\"\n"], [322, "      locations        = var.geo_restriction_type != null ? var.geo_restriction_locations : []\n"], [323, "    }\n"], [324, "  }\n"], [325, "\n"], [326, "  # SSL/TLS Certificate: use ACM when custom domains provided; otherwise default CF cert\n"], [327, "  viewer_certificate {\n"], [328, "    acm_certificate_arn            = length(var.domain_aliases) > 0 ? data.aws_acm_certificate.existing[0].arn : null\n"], [329, "    cloudfront_default_certificate = length(var.domain_aliases) == 0 ? true : null\n"], [330, "    ssl_support_method             = length(var.domain_aliases) > 0 ? \"sni-only\" : null\n"], [331, "    minimum_protocol_version       = \"TLSv1.2_2021\"\n"], [332, "  }\n"], [333, "\n"], [334, "  # Logging (optional but recommended)\n"], [335, "  dynamic \"logging_config\" {\n"], [336, "    for_each = var.enable_logging ? [1] : []\n"], [337, "    content {\n"], [338, "      bucket          = var.logging_bucket\n"], [339, "      prefix          = var.logging_prefix\n"], [340, "      include_cookies = false\n"], [341, "    }\n"], [342, "  }\n"], [343, "\n"], [344, "  # WAF Web ACL (optional but recommended for security)\n"], [345, "  web_acl_id = var.enable_waf ? aws_wafv2_web_acl.cloudfront[0].arn : var.web_acl_id\n"], [346, "\n"], [347, "  tags = merge(var.tags, {\n"], [348, "    Name = \"${var.bucket_name}-cloudfront\"\n"], [349, "  })\n"], [350, "}\n"]], "file_path": "\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf", "repo_file_path": "/infra/terraform/modules/hosting/main.tf", "file_line_range": [272, 350], "resource": "module.hosting.aws_cloudfront_distribution.website", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"environment": ["prod"], "managed_by": ["terraform"], "project": ["p1-serverless-web-app"], "Name": ["p1-serverless-web-app-prod-website-cloudfront"]}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-networking-policies/bc-aws-networking-65", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf"}, {"check_id": "CKV2_AWS_47", "bc_check_id": "BC_AWS_GENERAL_186", "check_name": "Ensure AWS CloudFront attached WAFv2 WebACL is configured with AMR for Log4j Vulnerability", "check_result": {"result": "FAILED", "entity": {"aws_cloudfront_distribution": {"website": {"__end_line__": 350, "__start_line__": 272, "aliases": ["p1.fikri.dev"], "comment": ["CloudFront distribution for p1-serverless-web-app-prod-website"], "default_cache_behavior": [{"allowed_methods": [[["GET"], ["HEAD"], ["OPTIONS"]]], "cache_policy_id": ["4135ea2d-6df8-44a3-9df3-4b5a84be39ad"], "cached_methods": [[["GET"], ["HEAD"]]], "compress": [true], "lambda_function_association": [{"event_type": ["origin-request"], "include_body": [false], "lambda_arn": ["aws_lambda_function.cloudfront_rewrite.qualified_arn"]}], "target_origin_id": ["S3-${aws_s3_bucket.website.id}"], "viewer_protocol_policy": ["redirect-to-https"]}], "default_root_object": ["index.html"], "dynamic": [{"custom_error_response": [{"error_code": [404], "response_code": [404], "response_page_path": ["/index.html"]}, {"error_code": [403], "response_code": [404], "response_page_path": ["/index.html"]}]}, {"logging_config": [{"bucket": ["var.logging_bucket"], "include_cookies": [false], "prefix": ["var.logging_prefix"]}]}], "enabled": [true], "is_ipv6_enabled": [true], "origin": [{"domain_name": ["aws_s3_bucket.website.bucket_regional_domain_name"], "origin_access_control_id": ["aws_cloudfront_origin_access_control.website.id"], "origin_id": ["S3-${aws_s3_bucket.website.id}"]}], "price_class": ["PriceClass_100"], "restrictions": [{"geo_restriction": [{"locations": [], "restriction_type": ["none"]}]}], "tags": [{"environment": ["prod"], "managed_by": ["terraform"], "project": ["p1-serverless-web-app"], "Name": ["p1-serverless-web-app-prod-website-cloudfront"]}], "viewer_certificate": [{"acm_certificate_arn": ["data.aws_acm_certificate.existing[0].arn"], "cloudfront_default_certificate": ["None"], "minimum_protocol_version": ["TLSv1.2_2021"], "ssl_support_method": ["sni-only"]}], "web_acl_id": ["aws_wafv2_web_acl.cloudfront[0].arn"], "__address__": "module.hosting.aws_cloudfront_distribution.website", "__provider_address__": "aws", "custom_error_response": [{"error_code": [404], "response_code": [404], "response_page_path": ["/index.html"]}, {"error_code": [403], "response_code": [404], "response_page_path": ["/index.html"]}], "logging_config": [{"bucket": ["var.logging_bucket"], "include_cookies": [false], "prefix": ["var.logging_prefix"]}]}}}, "evaluated_keys": ["resource_type", "rule/*/statement/managed_rule_group_statement/name"]}, "code_block": [[272, "resource \"aws_cloudfront_distribution\" \"website\" {\n"], [273, "  enabled             = true\n"], [274, "  is_ipv6_enabled     = true\n"], [275, "  comment             = \"CloudFront distribution for ${var.bucket_name}\"\n"], [276, "  default_root_object = var.default_root_object\n"], [277, "  price_class         = var.price_class\n"], [278, "\n"], [279, "  aliases = var.domain_aliases\n"], [280, "\n"], [281, "  origin {\n"], [282, "    domain_name              = aws_s3_bucket.website.bucket_regional_domain_name\n"], [283, "    origin_id                = \"S3-${aws_s3_bucket.website.id}\"\n"], [284, "    origin_access_control_id = aws_cloudfront_origin_access_control.website.id\n"], [285, "  }\n"], [286, "\n"], [287, "  default_cache_behavior {\n"], [288, "    allowed_methods        = [\"GET\", \"HEAD\", \"OPTIONS\"]\n"], [289, "    cached_methods         = [\"GET\", \"HEAD\"]\n"], [290, "    target_origin_id       = \"S3-${aws_s3_bucket.website.id}\"\n"], [291, "    compress               = true\n"], [292, "    viewer_protocol_policy = \"redirect-to-https\"\n"], [293, "\n"], [294, "    # Use managed cache policy for best practices\n"], [295, "    cache_policy_id = \"4135ea2d-6df8-44a3-9df3-4b5a84be39ad\" # CachingOptimized\n"], [296, "\n"], [297, "    # Lambda@Edge function to rewrite directory requests\n"], [298, "    lambda_function_association {\n"], [299, "      event_type   = \"origin-request\"\n"], [300, "      lambda_arn   = aws_lambda_function.cloudfront_rewrite.qualified_arn\n"], [301, "      include_body = false\n"], [302, "    }\n"], [303, "\n"], [304, "    # Security headers via response headers policy\n"], [305, "    # response_headers_policy_id = aws_cloudfront_response_headers_policy.security.id\n"], [306, "  }\n"], [307, "\n"], [308, "  # Custom error responses\n"], [309, "  dynamic \"custom_error_response\" {\n"], [310, "    for_each = var.custom_error_responses\n"], [311, "    content {\n"], [312, "      error_code         = custom_error_response.value.error_code\n"], [313, "      response_code      = custom_error_response.value.response_code\n"], [314, "      response_page_path = custom_error_response.value.response_page_path\n"], [315, "    }\n"], [316, "  }\n"], [317, "\n"], [318, "  # Geographic restrictions (required block, but can be set to \"none\")\n"], [319, "  restrictions {\n"], [320, "    geo_restriction {\n"], [321, "      restriction_type = var.geo_restriction_type != null ? var.geo_restriction_type : \"none\"\n"], [322, "      locations        = var.geo_restriction_type != null ? var.geo_restriction_locations : []\n"], [323, "    }\n"], [324, "  }\n"], [325, "\n"], [326, "  # SSL/TLS Certificate: use ACM when custom domains provided; otherwise default CF cert\n"], [327, "  viewer_certificate {\n"], [328, "    acm_certificate_arn            = length(var.domain_aliases) > 0 ? data.aws_acm_certificate.existing[0].arn : null\n"], [329, "    cloudfront_default_certificate = length(var.domain_aliases) == 0 ? true : null\n"], [330, "    ssl_support_method             = length(var.domain_aliases) > 0 ? \"sni-only\" : null\n"], [331, "    minimum_protocol_version       = \"TLSv1.2_2021\"\n"], [332, "  }\n"], [333, "\n"], [334, "  # Logging (optional but recommended)\n"], [335, "  dynamic \"logging_config\" {\n"], [336, "    for_each = var.enable_logging ? [1] : []\n"], [337, "    content {\n"], [338, "      bucket          = var.logging_bucket\n"], [339, "      prefix          = var.logging_prefix\n"], [340, "      include_cookies = false\n"], [341, "    }\n"], [342, "  }\n"], [343, "\n"], [344, "  # WAF Web ACL (optional but recommended for security)\n"], [345, "  web_acl_id = var.enable_waf ? aws_wafv2_web_acl.cloudfront[0].arn : var.web_acl_id\n"], [346, "\n"], [347, "  tags = merge(var.tags, {\n"], [348, "    Name = \"${var.bucket_name}-cloudfront\"\n"], [349, "  })\n"], [350, "}\n"]], "file_path": "\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf", "repo_file_path": "/infra/terraform/modules/hosting/main.tf", "file_line_range": [272, 350], "resource": "module.hosting.aws_cloudfront_distribution.website", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"environment": ["prod"], "managed_by": ["terraform"], "project": ["p1-serverless-web-app"], "Name": ["p1-serverless-web-app-prod-website-cloudfront"]}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/bc-aws-general-47", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf"}, {"check_id": "CKV2_AWS_62", "bc_check_id": "BC_AWS_LOGGING_36", "check_name": "Ensure S3 buckets should have event notifications enabled", "check_result": {"result": "FAILED", "entity": {"aws_s3_bucket": {"website": {"__end_line__": 39, "__start_line__": 33, "bucket": ["p1-serverless-web-app-prod-website"], "tags": [{"environment": "prod", "managed_by": "terraform", "project": "p1-serverless-web-app", "Name": "p1-serverless-web-app-prod-website"}], "__address__": "module.hosting.aws_s3_bucket.website", "__provider_address__": "aws"}}}, "evaluated_keys": ["resource_type"]}, "code_block": [[33, "resource \"aws_s3_bucket\" \"website\" {\n"], [34, "  bucket = var.bucket_name\n"], [35, "\n"], [36, "  tags = merge(var.tags, {\n"], [37, "    Name = var.bucket_name\n"], [38, "  })\n"], [39, "}\n"]], "file_path": "\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf", "repo_file_path": "/infra/terraform/modules/hosting/main.tf", "file_line_range": [33, 39], "resource": "module.hosting.aws_s3_bucket.website", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"environment": "prod", "managed_by": "terraform", "project": "p1-serverless-web-app", "Name": "p1-serverless-web-app-prod-website"}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-logging-policies/bc-aws-2-62", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf"}, {"check_id": "CKV_AWS_18", "bc_check_id": "BC_AWS_S3_13", "check_name": "Ensure the S3 bucket has access logging enabled", "check_result": {"result": "FAILED", "entity": {"aws_s3_bucket": {"website": {"__end_line__": 39, "__start_line__": 33, "bucket": ["p1-serverless-web-app-prod-website"], "tags": [{"environment": "prod", "managed_by": "terraform", "project": "p1-serverless-web-app", "Name": "p1-serverless-web-app-prod-website"}], "__address__": "module.hosting.aws_s3_bucket.website", "__provider_address__": "aws"}}}, "evaluated_keys": ["logging", "resource_type"]}, "code_block": [[33, "resource \"aws_s3_bucket\" \"website\" {\n"], [34, "  bucket = var.bucket_name\n"], [35, "\n"], [36, "  tags = merge(var.tags, {\n"], [37, "    Name = var.bucket_name\n"], [38, "  })\n"], [39, "}\n"]], "file_path": "\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf", "repo_file_path": "/infra/terraform/modules/hosting/main.tf", "file_line_range": [33, 39], "resource": "module.hosting.aws_s3_bucket.website", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"environment": "prod", "managed_by": "terraform", "project": "p1-serverless-web-app", "Name": "p1-serverless-web-app-prod-website"}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/s3-policies/s3-13-enable-logging", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf"}, {"check_id": "CKV_AWS_144", "bc_check_id": "BC_AWS_GENERAL_72", "check_name": "Ensure that S3 bucket has cross-region replication enabled", "check_result": {"result": "FAILED", "entity": {"aws_s3_bucket": {"website": {"__end_line__": 39, "__start_line__": 33, "bucket": ["p1-serverless-web-app-prod-website"], "tags": [{"environment": "prod", "managed_by": "terraform", "project": "p1-serverless-web-app", "Name": "p1-serverless-web-app-prod-website"}], "__address__": "module.hosting.aws_s3_bucket.website", "__provider_address__": "aws"}}}, "evaluated_keys": ["resource_type", "replication_configuration/rules/*/status", "rule/*/status"]}, "code_block": [[33, "resource \"aws_s3_bucket\" \"website\" {\n"], [34, "  bucket = var.bucket_name\n"], [35, "\n"], [36, "  tags = merge(var.tags, {\n"], [37, "    Name = var.bucket_name\n"], [38, "  })\n"], [39, "}\n"]], "file_path": "\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf", "repo_file_path": "/infra/terraform/modules/hosting/main.tf", "file_line_range": [33, 39], "resource": "module.hosting.aws_s3_bucket.website", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"environment": "prod", "managed_by": "terraform", "project": "p1-serverless-web-app", "Name": "p1-serverless-web-app-prod-website"}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-s3-bucket-has-cross-region-replication-enabled", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf"}, {"check_id": "CKV2_AWS_31", "bc_check_id": "BC_AWS_LOGGING_33", "check_name": "Ensure WAF2 has a Logging Configuration", "check_result": {"result": "FAILED", "entity": {"aws_wafv2_web_acl": {"cloudfront[0]": {"__end_line__": 199, "__start_line__": 132, "default_action": [{"allow": [{}]}], "description": ["WAF for CloudFront distribution - prod environment"], "name": ["p1-serverless-web-app-prod-cloudfront-waf"], "provider": ["aws.us_east_1"], "rule": [{"name": ["AWSManagedRulesCommonRuleSet"], "override_action": [{"none": [{}]}], "priority": [1], "statement": [{"managed_rule_group_statement": [{"name": ["AWSManagedRulesCommonRuleSet"], "vendor_name": ["AWS"]}]}], "visibility_config": [{"cloudwatch_metrics_enabled": [true], "metric_name": ["CommonRuleSetMetric"], "sampled_requests_enabled": [true]}]}, {"action": [{"block": [{}]}], "name": ["RateLimitRule"], "priority": [2], "statement": [{"rate_based_statement": [{"aggregate_key_type": ["IP"], "limit": [100]}]}], "visibility_config": [{"cloudwatch_metrics_enabled": [true], "metric_name": ["RateLimitRuleMetric"], "sampled_requests_enabled": [true]}]}], "scope": ["CLOUDFRONT"], "tags": [{"environment": "prod", "managed_by": "terraform", "project": "p1-serverless-web-app", "Name": "p1-serverless-web-app-prod-cloudfront-waf"}], "visibility_config": [{"cloudwatch_metrics_enabled": [true], "metric_name": ["CloudFrontWAFMetric"], "sampled_requests_enabled": [true]}], "__address__": "module.hosting.aws_wafv2_web_acl.cloudfront[0]", "__provider_address__": ""}}}, "evaluated_keys": ["resource_type"]}, "code_block": [[132, "resource \"aws_wafv2_web_acl\" \"cloudfront\" {\n"], [133, "  count    = var.enable_waf ? 1 : 0\n"], [134, "  provider = aws.us_east_1\n"], [135, "  \n"], [136, "  name        = \"${var.project}-${var.environment}-cloudfront-waf\"\n"], [137, "  description = \"WAF for CloudFront distribution - ${var.environment} environment\"\n"], [138, "  scope       = \"CLOUDFRONT\"\n"], [139, "\n"], [140, "  default_action {\n"], [141, "    allow {}\n"], [142, "  }\n"], [143, "\n"], [144, "  # AWS Managed Rules - Core Rule Set\n"], [145, "  rule {\n"], [146, "    name     = \"AWSManagedRulesCommonRuleSet\"\n"], [147, "    priority = 1\n"], [148, "\n"], [149, "    override_action {\n"], [150, "      none {}\n"], [151, "    }\n"], [152, "\n"], [153, "    statement {\n"], [154, "      managed_rule_group_statement {\n"], [155, "        name        = \"AWSManagedRulesCommonRuleSet\"\n"], [156, "        vendor_name = \"AWS\"\n"], [157, "      }\n"], [158, "    }\n"], [159, "\n"], [160, "    visibility_config {\n"], [161, "      cloudwatch_metrics_enabled = true\n"], [162, "      metric_name                = \"CommonRuleSetMetric\"\n"], [163, "      sampled_requests_enabled   = true\n"], [164, "    }\n"], [165, "  }\n"], [166, "\n"], [167, "  # Rate-based rule\n"], [168, "  rule {\n"], [169, "    name     = \"RateLimitRule\"\n"], [170, "    priority = 2\n"], [171, "\n"], [172, "    action {\n"], [173, "      block {}\n"], [174, "    }\n"], [175, "\n"], [176, "    statement {\n"], [177, "      rate_based_statement {\n"], [178, "        limit              = var.waf_rate_limit\n"], [179, "        aggregate_key_type = \"IP\"\n"], [180, "      }\n"], [181, "    }\n"], [182, "\n"], [183, "    visibility_config {\n"], [184, "      cloudwatch_metrics_enabled = true\n"], [185, "      metric_name                = \"RateLimitRuleMetric\"\n"], [186, "      sampled_requests_enabled   = true\n"], [187, "    }\n"], [188, "  }\n"], [189, "\n"], [190, "  visibility_config {\n"], [191, "    cloudwatch_metrics_enabled = true\n"], [192, "    metric_name                = \"CloudFrontWAFMetric\"\n"], [193, "    sampled_requests_enabled   = true\n"], [194, "  }\n"], [195, "\n"], [196, "  tags = merge(var.tags, {\n"], [197, "    Name = \"${var.project}-${var.environment}-cloudfront-waf\"\n"], [198, "  })\n"], [199, "}\n"]], "file_path": "\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf", "repo_file_path": "/infra/terraform/modules/hosting/main.tf", "file_line_range": [132, 199], "resource": "module.hosting.aws_wafv2_web_acl.cloudfront[0]", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"environment": "prod", "managed_by": "terraform", "project": "p1-serverless-web-app", "Name": "p1-serverless-web-app-prod-cloudfront-waf"}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-logging-policies/bc-aws-logging-33", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf"}, {"check_id": "CKV_AWS_145", "bc_check_id": "BC_AWS_GENERAL_56", "check_name": "Ensure that S3 buckets are encrypted with KMS by default", "check_result": {"result": "FAILED", "entity": {"aws_s3_bucket": {"website": {"__end_line__": 39, "__start_line__": 33, "bucket": ["p1-serverless-web-app-prod-website"], "tags": [{"environment": "prod", "managed_by": "terraform", "project": "p1-serverless-web-app", "Name": "p1-serverless-web-app-prod-website"}], "__address__": "module.hosting.aws_s3_bucket.website", "__provider_address__": "aws"}}}, "evaluated_keys": ["resource_type", "server_side_encryption_configuration/rule/apply_server_side_encryption_by_default/sse_algorithm", "rule/apply_server_side_encryption_by_default/sse_algorithm"]}, "code_block": [[33, "resource \"aws_s3_bucket\" \"website\" {\n"], [34, "  bucket = var.bucket_name\n"], [35, "\n"], [36, "  tags = merge(var.tags, {\n"], [37, "    Name = var.bucket_name\n"], [38, "  })\n"], [39, "}\n"]], "file_path": "\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf", "repo_file_path": "/infra/terraform/modules/hosting/main.tf", "file_line_range": [33, 39], "resource": "module.hosting.aws_s3_bucket.website", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"environment": "prod", "managed_by": "terraform", "project": "p1-serverless-web-app", "Name": "p1-serverless-web-app-prod-website"}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": {"code_block": [[51, "resource \"aws_s3_bucket_server_side_encryption_configuration\" \"website\" {\n"], [52, "  bucket = aws_s3_bucket.website.id\n"], [53, "\n"], [54, "  rule {\n"], [55, "    apply_server_side_encryption_by_default {\n"], [56, "      sse_algorithm = var.sse_algorithm\n"], [57, "    }\n"], [58, "    bucket_key_enabled = true\n"], [59, "  }\n"], [60, "}\n"]], "file_path": "\\main.tf", "file_line_range": [51, 60], "resource": "aws_s3_bucket_server_side_encryption_configuration.website", "entity_tags": {}, "evaluations": null, "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf", "resource_address": null}, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-general-policies/ensure-that-s3-buckets-are-encrypted-with-kms-by-default", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\hosting\\main.tf"}, {"check_id": "CKV2_AWS_40", "bc_check_id": "BC_AWS_IAM_73", "check_name": "Ensure AWS IAM policy does not allow full IAM privileges", "check_result": {"result": "FAILED", "entity": {"aws_iam_policy": {"terraform_dev_policy": {"__end_line__": 162, "__start_line__": 124, "name": ["TerraformDevPolicy"], "policy": [{"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Action": "*", "Resource": "*"}, {"Effect": "Deny", "Action": "*", "Resource": "*", "Condition": {"StringEquals": {"aws:ResourceTag/environment": "prod"}}}, {"Effect": "Deny", "Action": ["s3:GetObject", "s3:PutObject", "s3:DeleteObject"], "Resource": "arn:aws:s3:::terraform-731099197523/prod/*"}]}], "tags": [{"environment": "shared", "managed_by": "terraform", "project": "p1-serverless-web-app"}], "__address__": "module.iam_roles.aws_iam_policy.terraform_dev_policy", "__provider_address__": "aws.default"}}}, "evaluated_keys": ["statement[?(@/effect == Allow)]/actions[*]", "inline_policy/Statement[?(@/Effect == Allow)]/Action[*]", "policy/Statement[?(@/Effect == Allow)]/Action[*]"]}, "code_block": [[124, "resource \"aws_iam_policy\" \"terraform_dev_policy\" {\n"], [125, "  name = \"TerraformDevPolicy\"\n"], [126, "\n"], [127, "  policy = jsonencode({\n"], [128, "    Version = \"2012-10-17\"\n"], [129, "    Statement = [\n"], [130, "      {\n"], [131, "        Effect = \"Allow\"\n"], [132, "        Action = \"*\"\n"], [133, "        Resource = \"*\"\n"], [134, "      },\n"], [135, "      {\n"], [136, "        Effect = \"Deny\"\n"], [137, "        Action = \"*\"\n"], [138, "        Resource = \"*\"\n"], [139, "        Condition = {\n"], [140, "          StringEquals = {\n"], [141, "            \"aws:ResourceTag/environment\" = \"prod\"\n"], [142, "          }\n"], [143, "        }\n"], [144, "      },\n"], [145, "      {\n"], [146, "        Effect = \"Deny\"\n"], [147, "        Action = [\n"], [148, "          \"s3:GetObject\",\n"], [149, "          \"s3:PutObject\",\n"], [150, "          \"s3:DeleteObject\"\n"], [151, "        ]\n"], [152, "        Resource = \"${var.terraform_state_bucket_arn}/prod/*\"\n"], [153, "      }\n"], [154, "    ]\n"], [155, "  })\n"], [156, "\n"], [157, "  tags = {\n"], [158, "    project     = var.project\n"], [159, "    environment = \"shared\"\n"], [160, "    managed_by  = \"terraform\"\n"], [161, "  }\n"], [162, "}\n"]], "file_path": "\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf", "repo_file_path": "/infra/terraform/modules/iam-roles/main.tf", "file_line_range": [124, 162], "resource": "module.iam_roles.aws_iam_policy.terraform_dev_policy", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"environment": "shared", "managed_by": "terraform", "project": "p1-serverless-web-app"}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-iam-policies/bc-aws-2-40", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf"}, {"check_id": "CKV2_AWS_40", "bc_check_id": "BC_AWS_IAM_73", "check_name": "Ensure AWS IAM policy does not allow full IAM privileges", "check_result": {"result": "FAILED", "entity": {"aws_iam_policy": {"terraform_prod_policy": {"__end_line__": 184, "__start_line__": 165, "name": ["TerraformProdPolicy"], "policy": [{"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Action": "*", "Resource": "*"}]}], "tags": [{"environment": "shared", "managed_by": "terraform", "project": "p1-serverless-web-app"}], "__address__": "module.iam_roles.aws_iam_policy.terraform_prod_policy", "__provider_address__": "aws.default"}}}, "evaluated_keys": ["statement[?(@/effect == Allow)]/actions[*]", "inline_policy/Statement[?(@/Effect == Allow)]/Action[*]", "policy/Statement[?(@/Effect == Allow)]/Action[*]"]}, "code_block": [[165, "resource \"aws_iam_policy\" \"terraform_prod_policy\" {\n"], [166, "  name = \"TerraformProdPolicy\"\n"], [167, "\n"], [168, "  policy = jsonencode({\n"], [169, "    Version = \"2012-10-17\"\n"], [170, "    Statement = [\n"], [171, "      {\n"], [172, "        Effect = \"Allow\"\n"], [173, "        Action = \"*\"\n"], [174, "        Resource = \"*\"\n"], [175, "      }\n"], [176, "    ]\n"], [177, "  })\n"], [178, "\n"], [179, "  tags = {\n"], [180, "    project     = var.project\n"], [181, "    environment = \"shared\"\n"], [182, "    managed_by  = \"terraform\"\n"], [183, "  }\n"], [184, "}\n"]], "file_path": "\\main.tf", "file_abs_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf", "repo_file_path": "/infra/terraform/modules/iam-roles/main.tf", "file_line_range": [165, 184], "resource": "module.iam_roles.aws_iam_policy.terraform_prod_policy", "evaluations": null, "check_class": "checkov.common.graph.checks_infra.base_check", "fixed_definition": null, "entity_tags": {"environment": "shared", "managed_by": "terraform", "project": "p1-serverless-web-app"}, "caller_file_path": null, "caller_file_line_range": null, "resource_address": null, "severity": null, "bc_category": null, "benchmarks": null, "description": null, "short_description": null, "vulnerability_details": null, "connected_node": null, "guideline": "https://docs.prismacloud.io/en/enterprise-edition/policy-reference/aws-policies/aws-iam-policies/bc-aws-2-40", "details": [], "check_len": null, "definition_context_file_path": "C:\\DEMOP\\p1-serverless-web-app\\infra\\terraform\\modules\\iam-roles\\main.tf"}]}, "summary": {"passed": 84, "failed": 34, "skipped": 0, "parsing_errors": 0, "resource_count": 29, "checkov_version": "3.2.495"}}